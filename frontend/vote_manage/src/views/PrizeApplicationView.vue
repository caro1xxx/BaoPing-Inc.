<template>
  <div class="home">
    <Search />
    <div class="home_title">奖品申请</div>
    <div class="prize_list">
      <div class="grid" v-for="(item, index) in prizedata" :key="item">
      <div>#{{ index + 1 }}</div>
      <div class="prize_item">
        <svg t="1677479328117" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="25963" width="20" height="20">
        <path d="M682.225853 470.765979c8.511293-8.511293 21.278232-17.022585 29.789524-29.789524 51.067756-59.579048 72.345987-136.180682 59.579048-217.037962-17.022585-114.902451-106.391158-204.271023-221.293608-221.293609-93.624219-12.766939-182.992792 21.278232-242.57184 89.368573-46.812109 63.834695-72.345987 140.436328-59.579049 217.037962 12.766939 63.834695 42.556463 119.158097 93.624219 161.71456-148.947621 51.067756-255.338779 191.504084-255.338779 353.218644v93.624219C86.435368 977.187891 133.247478 1024 192.826526 1024h638.346948c59.579048 0 106.391158-46.812109 106.391158-106.391158v-93.624219c0-161.71456-106.391158-302.150888-255.338779-353.218644zM375.819318 151.592505c34.045171-42.556463 85.112926-63.834695 136.180682-63.834694 8.511293 0 17.022585 0 29.789524 4.255646 76.601634 12.766939 136.180682 76.601634 148.947621 148.947621 8.511293 55.323402-8.511293 106.391158-42.556463 144.691975-42.556463 46.812109-102.135512 72.345987-165.970206 59.579048-76.601634-12.766939-136.180682-76.601634-148.947621-148.947621-8.511293-51.067756 8.511293-106.391158 42.556463-144.691975z m476.632387 766.016337c0 12.766939-8.511293 21.278232-21.278231 21.278232h-638.346948c-12.766939 0-21.278232-8.511293-21.278231-21.278232v-93.624219c0-161.71456 131.925036-289.383949 289.383949-289.383949h97.879865c161.71456 0 289.383949 131.925036 289.38395 289.383949v93.624219z" fill="#000000" p-id="25964">
        </path></svg>
        <span>{{ item.username }}</span>
      </div>
      <div class="prize_item">
        <svg t="1677479450316" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="26325" width="20" height="20">
        <path d="M512 938.652444c-235.264 0-426.666667-191.402667-426.666667-426.666666s191.402667-426.666667 426.666667-426.666667 426.666667 191.402667 426.666667 426.666667c0 55.552-10.538667 109.639111-31.317334 160.739555a42.709333 42.709333 0 0 1-55.608889 23.438223 42.695111 42.695111 0 0 1-23.452444-55.608889A339.256889 339.256889 0 0 0 853.333333 511.985778c0-188.202667-153.130667-341.333333-341.333333-341.333334s-341.333333 153.130667-341.333333 341.333334 153.130667 341.333333 341.333333 341.333333c53.333333 0 104.391111-11.946667 151.736889-35.484444a42.666667 42.666667 0 0 1 38.001778 76.416A422.684444 422.684444 0 0 1 512 938.652444" fill="#000000" p-id="26326">
        </path><path d="M512 369.763556c-78.421333 0-142.222222 63.800889-142.222222 142.222222s63.800889 142.222222 142.222222 142.222222a142.222222 142.222222 0 0 0 142.222222-142.222222c0-78.421333-63.800889-142.222222-142.222222-142.222222m0 369.777777c-125.468444 0-227.555556-102.087111-227.555556-227.555555s102.087111-227.555556 227.555556-227.555556 227.555556 102.087111 227.555556 227.555556a227.498667 227.498667 0 0 1-227.555556 227.555555" fill="#000000" p-id="26327">
        </path><path d="M765.368889 782.791111c-7.822222 0-15.431111-0.768-22.755556-2.275555C689.749333 769.592889 654.222222 722.488889 654.222222 663.324444V327.096889a42.666667 42.666667 0 1 1 85.333334 0v336.213333c0 10.993778 2.631111 29.980444 20.337777 33.649778 19.569778 3.982222 49.322667-12.202667 68.750223-57.230222a42.680889 42.680889 0 0 1 78.364444 33.806222c-33.393778 77.312-91.562667 109.269333-141.653333 109.269333" fill="#000000" p-id="26328">
        </path></svg>
        <span>{{ item.name }}</span>
      </div>
      <div class="span-col-2 prize_item">
        <svg t="1677479598962" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="28403" width="20" height="20">
        <path d="M256 85.333333h512c64.8 0 117.333333 52.533333 117.333333 117.333334v618.666666c0 64.8-52.533333 117.333333-117.333333 117.333334H256c-64.8 0-117.333333-52.533333-117.333333-117.333334V202.666667c0-64.8 52.533333-117.333333 117.333333-117.333334z m0 64a53.333333 53.333333 0 0 0-53.333333 53.333334v618.666666a53.333333 53.333333 0 0 0 53.333333 53.333334h512a53.333333 53.333333 0 0 0 53.333333-53.333334V202.666667a53.333333 53.333333 0 0 0-53.333333-53.333334H256z m170.666667 618.666667a32 32 0 0 1 0-64h170.666666a32 32 0 0 1 0 64H426.666667z" fill="#000000" p-id="28404">
        </path></svg>
        <span>{{ item.phone_number }}</span>
      </div>
      <div class="span-col-2 prize_item">
        <svg t="1677476217915" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15581" width="20" height="20">
        <path d="M1019.41937 299.5C952.61937 179.9 845.01937 87.8 716.51937 40.2c-18.8-7-39.8 2.7-46.8 21.5-7 18.9 2.7 39.8 21.5 46.8C803.51937 150 897.41937 230.5 955.71937 335c6.7 11.9 19 18.7 31.8 18.7 6 0 12.1-1.5 17.7-4.6 17.7-9.8 24-32 14.2-49.6zM332.81937 108.5c18.9-7 28.5-27.9 21.5-46.8s-28-28.5-46.8-21.5C179.01937 87.8 71.41937 179.9 4.61937 299.5c-9.8 17.6-3.5 39.7 14.1 49.5 5.6 3.1 11.7 4.6 17.7 4.6 12.8 0 25.2-6.7 31.8-18.7 58.4-104.4 152.3-184.8 264.6-226.4zM512.21937 429.6c-20.1 0-36.4 16.3-36.4 36.4v127.1c0 20.1 16.3 36.4 36.4 36.4h127.1c20.1 0 36.4-16.3 36.4-36.4 0-20.1-16.3-36.4-36.4-36.4h-90.7V466c0-20.1-16.3-36.4-36.4-36.4z" fill="#000000" p-id="15582">
        </path><path d="M296.71937 241.5c-16.9 10.9-21.8 33.4-10.9 50.3s33.4 21.8 50.3 10.9c153.8-98.9 359.3-54.2 458.2 99.6 47.9 74.5 63.9 163.1 45.1 249.7-15 69.1-50.8 130.2-102.5 176.4-2.1 1.4-4.1 3-5.9 4.8-0.6 0.6-1.1 1.2-1.6 1.8-10.9 9.2-22.4 17.7-34.6 25.5-74.5 47.9-163.1 63.9-249.7 45.1-86.5-18.8-160.6-70.2-208.5-144.7-73.6-114.5-70.3-260.2 8.5-371.2 11.6-16.4 7.8-39.1-8.6-50.8-16.4-11.6-39.1-7.8-50.8 8.6-96.1 135.4-100.1 313.1-10.4 452.8 12.9 20.1 27.4 38.8 43.3 56.1l-63.5 63.5c-14.2 14.2-14.2 37.3 0 51.5 7.1 7.1 16.4 10.7 25.7 10.7s18.6-3.6 25.8-10.7l66-66.1c45.9 34.5 99.1 58.9 156.9 71.5 28.8 6.3 57.8 9.4 86.7 9.4 76.7 0 151.9-21.9 217.9-64.4 6.9-4.4 13.6-9 20.1-13.8l63.4 63.4c7.1 7.1 16.4 10.7 25.7 10.7s18.6-3.6 25.7-10.7c14.2-14.2 14.2-37.3 0-51.5l-60-60c50.4-53 85.5-119 101.5-192.3 22.9-105.5 3.4-213.7-55-304.5C735.01937 175.3 484.31937 120.9 296.71937 241.5z" fill="#000000" p-id="15583">
        </path></svg>
        <span>{{ gettime(item.create_time) }}</span>
      </div>
      <div></div>
      <div class="prize_item prize_sure">
        <!-- 状态正确 -->
        <svg @click="changestatus(item, index)" v-if="item.status" t="1677475207777" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4111" width="20" height="20">
          <path d="M512 1015.345c-277.909 0-503.198-225.29-503.198-503.198s225.287-503.196 503.198-503.196c277.907 0 503.198 225.29 503.198 503.198s-225.29 503.196-503.198 503.196zM512 71.851c-243.163 0-440.295 197.134-440.295 440.297s197.134 440.295 440.295 440.295 440.295-197.134 440.295-440.295-197.134-440.297-440.295-440.297zM713.042 337.108c8.681-15.049 3.543-34.274-11.506-42.957s-34.274-3.543-42.957 11.506l-201.147 348.361-112.531-103.77c-11.856-12.674-31.756-13.329-44.45-1.453-12.676 11.876-13.308 31.778-1.432 44.452l143.776 132.617c11.876 12.674 31.778 13.308 44.452 1.432 3.825-3.582 225.793-390.19 225.793-390.19z" fill="#3CDA72" p-id="4112">  
          </path></svg>
        <!-- 状态错误 -->
        <svg v-else @click="changestatus(item, index)" t="1677475358125" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5243" width="20" height="20">
          <path d="M512 128c212 0 384 172 384 384s-172 384-384 384-384-172-384-384 172-384 384-384m0-64C264.8 64 64 264.8 64 512s200.8 448 448 448 448-200.8 448-448S759.2 64 512 64z m238.4 254.4l-45.6-45.6L512 467.2 318.4 273.6l-45.6 45.6L467.2 512 273.6 705.6l45.6 45.6L512 557.6l193.6 193.6 45.6-45.6L557.6 512l192.8-193.6z" p-id="5244" fill="#F40606">
          </path></svg>
      </div>
      <div class="prize_item prize_sure">
        <svg @click="deleteprize(item)" t="1677475434506" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6493" id="mx_n_1677475434509" width="20" height="20">
        <path d="M607.897867 768.043004c-17.717453 0-31.994625-14.277171-31.994625-31.994625L575.903242 383.935495c0-17.717453 14.277171-31.994625 31.994625-31.994625s31.994625 14.277171 31.994625 31.994625l0 351.94087C639.892491 753.593818 625.61532 768.043004 607.897867 768.043004z" fill="#F40606" p-id="6494">
        </path><path d="M415.930119 768.043004c-17.717453 0-31.994625-14.277171-31.994625-31.994625L383.935495 383.935495c0-17.717453 14.277171-31.994625 31.994625-31.994625 17.717453 0 31.994625 14.277171 31.994625 31.994625l0 351.94087C447.924744 753.593818 433.647573 768.043004 415.930119 768.043004z" fill="#F40606" p-id="6495">
        </path><path d="M928.016126 223.962372l-159.973123 0L768.043004 159.973123c0-52.980346-42.659499-95.983874-95.295817-95.983874L351.94087 63.989249c-52.980346 0-95.983874 43.003528-95.983874 95.983874l0 63.989249-159.973123 0c-17.717453 0-31.994625 14.277171-31.994625 31.994625s14.277171 31.994625 31.994625 31.994625l832.032253 0c17.717453 0 31.994625-14.277171 31.994625-31.994625S945.73358 223.962372 928.016126 223.962372zM319.946246 159.973123c0-17.545439 14.449185-31.994625 31.994625-31.994625l320.806316 0c17.545439 0 31.306568 14.105157 31.306568 31.994625l0 63.989249L319.946246 223.962372 319.946246 159.973123 319.946246 159.973123z" fill="#F40606" p-id="6496">
        </path><path d="M736.048379 960.010751 288.123635 960.010751c-52.980346 0-95.983874-43.003528-95.983874-95.983874L192.139761 383.591466c0-17.717453 14.277171-31.994625 31.994625-31.994625s31.994625 14.277171 31.994625 31.994625l0 480.435411c0 17.717453 14.449185 31.994625 31.994625 31.994625l448.096758 0c17.717453 0 31.994625-14.277171 31.994625-31.994625L768.215018 384.795565c0-17.717453 14.277171-31.994625 31.994625-31.994625s31.994625 14.277171 31.994625 31.994625l0 479.231312C832.032253 916.835209 789.028725 960.010751 736.048379 960.010751z" fill="#F40606" p-id="6497">
        </path></svg>
      </div>
    </div>
    </div>
  </div>
</template>

<script setup>
import Search from "@/components/Search.vue"
import { fether } from "@/utils/fether"
import { reactive } from "vue"
import { useStore } from "vuex"
import Cookies from 'js-cookie'
const $store = new useStore()

// 奖品申请数据
const prizedata = reactive([])

// 获取奖品列表
const getprize = async () => {
  //开启加载loading
  await $store.dispatch("NoticifyActions", true);
  let result = await fether(
    `/applyprize/?token=${Cookies.get('token')}`
  )
  if (result.code === 200) {
    prizedata.push(...result.data)
  } else {
    //请求发送错误
    await $store.dispatch("refreshErroActions");
    await $store.dispatch("GlobalMessageActions", "操作失败,请刷新");
  }
  //关闭加载loading
  $store.commit("noticifyLoading", false);
}
getprize()

// 将时间戳转换
const gettime = (value) => {
  let Time = new Date()
  let y = Time.getFullYear(value)
  let m = Time.getMonth(value) + 1
  let d = Time.getDate(value)
  let h = Time.getHours(value)
  let M = Time.getMinutes(value)
  let s = Time.getSeconds(value)
  let str = ''
  str = `${y}/${zroon(m)}/${zroon(d)} ${zroon(h)}:${zroon(M)}:${zroon(s)}`
  return str
}
// 补零
const zroon = (number) => {
  if (number < 10) {
    return `0${number}`
  } else {
    return number
  }
}

// 状态改变
const changestatus = async  (value, index) => {
  //开启加载loading
  await $store.dispatch("NoticifyActions", true);
  let result = await fether(`/applyprize/`, `put`, {
    token: Cookies.get("token"),
    status: value.status,
    apply_prize_id: value.apply_prize_id
  })
  if (result.code === 200) {
    prizedata[index].status = !prizedata[index].status
  }
  await $store.dispatch("GlobalMessageActions", result.msg);
  // 关闭加载loading
  $store.commit("noticifyLoading", false);
}

// 删除奖品数据
const deleteprize = async () => {
  //开启加载loading
  await $store.dispatch("NoticifyActions", true);
  let result = await fether(`/applyprize/`, `delete`, {
    token: Cookies.get("token"),
    apply_prize_id: value.apply_prize_id
  })
  await $store.dispatch("GlobalMessageActions", result.msg);
  // 关闭加载loading
  $store.commit("noticifyLoading", false);
}
</script>

<style lang="scss" scoped>
.home {
  width: calc(100vw - 250px - 40px);
  height: calc(100vh - 40px);
  font-size: 20px;
  padding: 20px;
}
.home_title {
  font-size: 20px;
  font-weight: bold;
  margin: 20px 0px;
  cursor: pointer;
  user-select: none;
}
.prize_list{
  height: calc(100vh - 148px);
  overflow-y: scroll;
}
.prize_list::-webkit-scrollbar {
  display: none;
  -ms-overflow-style: none; /* IE and Edge */
  scrollbar-width: none; /* Firefox */
}
.grid {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  margin-top: 10px;
  color: #000;
  grid-template-rows: 40px;
  font-size: 15px;
  background-color: #FFFFFF;
  border-radius: 5px;
  border: 1px solid #D9D9D9;
  place-items: center;
}
.span-col-2{grid-column: span 2 / auto;}
.prize_item{
  display: flex;
  justify-content: center;
  align-items: center;
}
.prize_sure{
  cursor: pointer;
}
span{
  margin-left: 10PX;
}
</style>
